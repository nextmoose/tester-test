name: "Test"
on:
  push:
jobs:
  pre-check:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    - uses: cachix/install-nix-action@v17
      with:
        extra_nix_config: |
          access-tokens = github.com=${{ secrets.TOKEN }}
    - run: cd $( mktemp --directory ) && git init && git config user.name "No User" && git config user.email "noone@nothing" && nix flake init && sed -e "s#\${IMPLEMENTATION}#github:nextmoose/tester#" -e "s#\${TEST}#github:nextmoose/tester-test.git#" -e "s#\${TESTER}#github:nextmoose/tester#" -e "wflake.nix" ${GITHUB_WORKSPACE}/.github/workflows/flake.nix && git add flake.nix && git commit --all --allow-empty-message --message "" && nix develop --command check ""
  check:
    needs: pre-check
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    - uses: cachix/install-nix-action@v17
      with:
        extra_nix_config: |
          access-tokens = github.com=${{ secrets.TOKEN }}
    - run: cd $( mktemp --directory ) && git init && git config user.name "No User" && git config user.email "noone@nothing" && nix flake init && sed -e "s#\${IMPLEMENTATION}#github:nextmoose/tester.git#" -e "s#\${TEST}#${GITHUB_WORKSPACE}#" -e "s#\${TESTER}#github:nextmoose/tester#" -e "wflake.nix" ${GITHUB_WORKSPACE}/.github/workflows/flake.nix && git add flake.nix && git commit --all --allow-empty-message --message "" && nix develop --command check ""

